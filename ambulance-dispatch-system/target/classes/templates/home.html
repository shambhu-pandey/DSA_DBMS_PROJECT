<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
Â  <title>Ambulance Dispatch System</title>
Â  <style>
  /* ğŸ”· Base Layout */
  body {
    font-family: 'Segoe UI', Arial, sans-serif;
    margin: 0;
    background: #eef4f9;
    color: #333;
  }

  h1 {
    text-align: center;
    color: #007bff;
    margin: 28px 0 12px;
    font-size: 2.3em;
    letter-spacing: 1px;
  }

  /* ğŸ”· Navigation Bar */
  nav {
    background: #004080;
    padding: 12px;
    text-align: center;
    position: sticky;
    top: 0;
    z-index: 1000;
    box-shadow: 0 2px 8px rgba(0,0,0,0.1);
  }

  nav button {
    background: none;
    border: none;
    color: white;
    font-weight: bold;
    font-size: 1em;
    margin: 0 10px;
    padding: 6px 12px;
    cursor: pointer;
    border-radius: 6px;
    transition: background 0.2s;
  }

  nav button:hover {
    background: rgba(255,255,255,0.2);
  }

  /* ğŸ”· Section Container */
  .section {
    margin: 20px auto;
    padding: 28px 36px;
    background: #fff;
    border-radius: 16px;
    box-shadow: 0 4px 20px rgba(0,0,0,0.07);
    max-width: 900px;
  }

  .section h2 {
    color: #007bff;
    margin-bottom: 18px;
    font-size: 1.45em;
    letter-spacing: 0.5px;
    border-bottom: 2px solid #e0e0e0;
    padding-bottom: 4px;
  }

  /* ğŸ”· Form Group Spacing */
  .form-group {
    margin: 2px 0; /* ğŸ”§ Adjust vertical spacing between label-input pairs */
  }

  label {
    display: block;
    font-weight: 500;
    color: #444;
    margin-bottom: 2px; /* ğŸ”§ Space between label and input */
  }

  input, select {
    padding: 9px;
    width: 100%;
    border: 1px solid #bbb;
    border-radius: 6px;
    font-size: 1em;
    margin-bottom: 2px; /* ğŸ”§ Space below each input box */
    background: #f7fbff;
    transition: border 0.2s;
  }

  input:focus, select:focus {
    border: 1.5px solid #007bff;
    outline: none;
    background: #fff;
  }

  /* ğŸ”· Buttons */
  button {
    padding: 10px 24px;
    background: linear-gradient(90deg,#007bff,#00c6ff);
    color: white;
    border: none;
    border-radius: 6px;
    cursor: pointer;
    font-weight: 600;
    font-size: 1.05em;
    box-shadow: 0 2px 6px rgba(0,0,0,0.06);
    transition: background 0.2s, box-shadow 0.2s;
  }

  button:hover {
    background: linear-gradient(90deg,#0056b3,#007bff);
    box-shadow: 0 4px 12px rgba(0,0,0,0.08);
  }

  /* ğŸ”· Result Message Box */
  .result {
    margin: 5px 0;
    padding: 14px;
    background: #eaf6ff;
    border-radius: 8px;
    border-left: 5px solid #007bff;
    font-size: 1.08em;
    box-shadow: 0 2px 6px rgba(0,0,0,0.03);
  }

  /* ğŸ”· Tables */
  table {
    width: 100%;
    border-collapse: separate;
    border-spacing: 0;
    margin-top: 7px;
    background: #fff;
    border-radius: 12px;
    overflow: hidden;
    box-shadow: 0 2px 6px rgba(0,0,0,0.04);
  }

  th {
    background: #007bff;
    color: #fff;
    font-weight: 600;
    padding: 12px;
    font-size: 1.05em;
    border-right: 1px solid #e0e0e0;
  }

  td {
    padding: 11px;
    text-align: left;
    font-size: 1em;
    vertical-align: top;
    border-right: 1px solid #f0f0f0;
    border-bottom: 1px solid #f0f0f0;
  }

  tbody tr:nth-child(even) {
    background: #f7fbff;
  }

  tbody tr:hover {
    background: #e3f2fd;
  }

  th.why, td.why {
    background: #fffbe6;
    color: #ff9800;
    border-left: 4px solid #ff9800;
  }

  /* ğŸ”· Refresh Button */
  .refresh-btn {
    float: right;
    margin-bottom: 6px;
    background: #fff;
    color: #007bff;
    border: 2px solid #007bff;
    border-radius: 6px;
    font-weight: 600;
    padding: 6px 16px;
    transition: background 0.2s, color 0.2s;
  }

  .refresh-btn:hover {
    background: #007bff;
    color: #fff;
  }

  /* ğŸ”· Notification Area */
  #notification-area {
    position: fixed;
    bottom: 20px;
    right: 20px;
    z-index: 2000;
  }

  #notification-area > button {
    background: #ff9800;
    color: white;
    border: none;
    border-radius: 50px;
    padding: 10px 18px;
    font-weight: bold;
    cursor: pointer;
    box-shadow: 0 4px 12px rgba(0,0,0,0.15);
  }

  #notif-list {
    position: absolute;
    bottom: 50px;
    right: 0;
    width: 300px;
    max-height: 400px;
    overflow-y: auto;
    background: white;
    border: 1px solid #ccc;
    border-radius: 8px;
    padding: 10px;
    box-shadow: 0 4px 15px rgba(0,0,0,0.2);
  }

  #notif-list div {
    padding: 8px 0;
    border-bottom: 1px dashed #eee;
  }

  #notif-list div:last-child {
    border-bottom: none;
  }

  #notif-list button {
    background: #007bff;
    color: white;
    padding: 4px 8px;
    margin-top: 4px;
    font-size: 0.8em;
    border-radius: 4px;
  }

  /* ğŸ”· Responsive Layout */
  @media (max-width: 900px) {
    .section { max-width: 98vw; padding: 16px; }
    input, select { width: 100%; }
    #historyTable td.why { max-width: 140px; font-size: 0.95em; }
  }
</style>



</head>
<body>
Â  <h1>ğŸš‘ Ambulance Dispatch System</h1>

Â  Â  <nav>
Â  Â  <button onclick="showSection('hospital')">ğŸ¥ Hospital</button>
Â  Â  <button onclick="showSection('ambulance')">ğŸš Ambulance</button>
Â  Â  <button onclick="showSection('request')">ğŸš¨ Request</button>
Â  Â  <button onclick="showSection('update')">ğŸ”„ Update Status</button>
Â  Â  <button onclick="showSection('dispatch')">ğŸ“œ Dispatch</button>
Â  Â  <button onclick="showSection('reassigned')">â³ Reassigned</button>
Â  Â  <button onclick="showSection('notifications')">ğŸ”” Notifications</button>
Â  </nav>

Â  Â  <div id="hospital" class="section" style="display:block;">
Â  Â  <h2>ğŸ¥ Register Hospital</h2>
Â  Â  <form id="hospitalForm">
Â  Â  Â  Â  <div class="form-group">
Â  Â  Â  Â  Â  Â  <label for="hospitalName">Hospital Name:</label>
Â  Â  Â  Â  Â  Â  <input type="text" id="hospitalName" required>
Â  Â  Â  Â  </div>
Â  Â  Â  Â  <div class="form-group">
Â  Â  Â  Â  Â  Â  <label for="hospitalLocation">Location:</label>
Â  Â  Â  Â  Â  Â  <input type="text" id="hospitalLocation" required>
Â  Â  Â  Â  </div>
Â  Â  Â  Â  <div class="form-group">
Â  Â  Â  Â  Â  Â  <label for="hospitalPincode">Pincode:</label>
Â  Â  Â  Â  Â  Â  <input type="text" id="hospitalPincode" required>
Â  Â  Â  Â  </div>
Â  Â  Â  Â  <div class="form-group">
Â  Â  Â  Â  Â  Â  <label for="availableBeds">Available Beds:</label>
Â  Â  Â  Â  Â  Â  <input type="number" id="availableBeds" required>
Â  Â  Â  Â  </div>
Â  Â  Â  Â  <button type="submit">Register Hospital</button>
Â  Â  </form>
Â  Â  <div id="hospitalResult" class="result" style="display: none;"></div>

Â  Â  
    <h2>ğŸ¥ Hospital List</h2>
    <button class="refresh-btn" onclick="loadHospitals()">ğŸ”„ Refresh</button>
    <table id="hospitalTable">
        <thead>
            <tr>
                <th>ID</th>
                <th>Name</th>
                <th>Location</th>
                <th>Pincode</th>
                <th>Available Beds</th>
                <th>Action</th>
            </tr>
        </thead>
        <tbody></tbody>
    </table>
Â  </div>

Â  <div id="ambulance" class="section" style="display:none;">
Â  Â  <h2>ğŸš Register Ambulance</h2>
Â  Â  <form id="ambulanceForm">
Â  Â  Â  Â  <div class="form-group">
Â  Â  Â  Â  Â  Â  <label for="ambulanceId">Ambulance ID:</label>
Â  Â  Â  Â  Â  Â  <input type="text" id="ambulanceId" required>
Â  Â  Â  Â  </div>
Â  Â  Â  Â  <div class="form-group">
Â  Â  Â  Â  Â  Â  <label for="ambulanceHospital">Hospital ID:</label>
Â  Â  Â  Â  Â  Â  <input type="text" id="ambulanceHospital" required>
Â  Â  Â  Â  </div>
Â  Â  Â  Â  <div class="form-group">
Â  Â  Â  Â  Â  Â  <label for="ambulanceLocation">Location:</label>
Â  Â  Â  Â  Â  Â  <input type="text" id="ambulanceLocation" required>
Â  Â  Â  Â  </div>
Â  Â  Â  Â  <div class="form-group">
Â  Â  Â  Â  Â  Â  <label for="ambulancePincode">Pincode:</label>
Â  Â  Â  Â  Â  Â  <input type="text" id="ambulancePincode" required>
Â  Â  Â  Â  </div>
Â  Â  Â  Â  <div class="form-group">
Â  Â  Â  Â  Â  Â  <label for="driverName">Driver Name:</label>
Â  Â  Â  Â  Â  Â  <input type="text" id="driverName" required>
Â  Â  Â  Â  </div>
Â  Â  Â  Â  <div class="form-group">
Â  Â  Â  Â  Â  Â  <label for="driverPhone">Driver Phone:</label>
Â  Â  Â  Â  Â  Â  <input type="text" id="driverPhone" required>
Â  Â  Â  Â  </div>
Â  Â  Â  Â  <button type="submit">Register Ambulance</button>
Â  Â  </form>
Â  Â  <div id="ambulanceResult" class="result" style="display: none;"></div>

Â  Â  <h2>ğŸ“Š Ambulance List</h2>
    <button class="refresh-btn" onclick="loadAmbulances()">ğŸ”„ Refresh</button>
    <table id="ambulanceTable">
        <thead>
            <tr>
                <th>ID</th>
                <th>Hospital ID</th>
                <th>Location</th>
                <th>Pincode</th>
                <th>Driver</th>
                <th>Status</th>
            </tr>
        </thead>
        <tbody></tbody>
    </table>
Â  </div>

Â  <div id="request" class="section" style="display:none;">
Â  Â  <h2>ğŸš¨ New Emergency Request</h2>
Â  Â  <form id="emergencyForm">
Â  Â  Â  Â  <div class="form-group">
Â  Â  Â  Â  Â  Â  <label for="patientName">Patient Name:</label>
Â  Â  Â  Â  Â  Â  <input type="text" id="patientName" required>
Â  Â  Â  Â  </div>
Â  Â  Â  Â  <div class="form-group">
Â  Â  Â  Â  Â  Â  <label for="contactNo">Contact Number:</label>
Â  Â  Â  Â  Â  Â  <input type="text" id="contactNo" required>
Â  Â  Â  Â  </div>
Â  Â  Â  Â  <div class="form-group">
Â  Â  Â  Â  Â  Â  <label for="emergencyType">Emergency Type:</label>
Â  Â  Â  Â  Â  Â  <select id="emergencyType" required>
Â  Â  Â  Â  Â  Â  Â  Â  <option value="CRITICAL">Critical</option>
Â  Â  Â  Â  Â  Â  Â  Â  <option value="MAJOR">Major</option>
Â  Â  Â  Â  Â  Â  Â  Â  <option value="MINOR">Minor</option>
Â  Â  Â  Â  Â  Â  Â  Â  <option value="OTHER">Other</option>
Â  Â  Â  Â  Â  Â  </select>
Â  Â  Â  Â  </div>
Â  Â  Â  Â  <div class="form-group">
Â  Â  Â  Â  Â  Â  <label for="patientLocation">Patient Location:</label>
Â  Â  Â  Â  Â  Â  <input type="text" id="patientLocation" required>
Â  Â  Â  Â  </div>
Â  Â  Â  Â  <div class="form-group">
Â  Â  Â  Â  Â  Â  <label for="patientPincode">Patient Pincode:</label>
Â  Â  Â  Â  Â  Â  <input type="text" id="patientPincode" required>
Â  Â  Â  Â  </div>
Â  Â  Â  Â  <button type="submit">Create Emergency Request</button>
Â  Â  </form>
Â  Â  <div id="emergencyResult" class="result" style="display: none;"></div>
Â  </div>

Â  <div id="update" class="section" style="display:none;">
Â  Â  <h2>ğŸš Update Ambulance Status</h2>
Â  Â  <form id="updateAmbulanceForm">
Â  Â  Â  Â  <label for="updateAmbulanceId">Ambulance ID:</label>
Â  Â  Â  Â  <input type="text" id="updateAmbulanceId" required>
Â  Â  Â  Â  <label for="ambulanceStatus">Status:</label>
Â  Â  Â  Â  <select id="ambulanceStatus">
Â  Â  Â  Â  Â  Â  <option value="AVAILABLE">AVAILABLE</option>
Â  Â  Â  Â  Â  Â  <option value="BUSY">BUSY</option>
Â  Â  Â  Â  Â  Â  <option value="OFFLINE">OFFLINE</option>
Â  Â  Â  Â  </select>
Â  Â  Â  Â  <button type="submit">Update</button>
Â  Â  </form>
Â  Â  <div id="updateResult" class="result" style="display: none;"></div>
Â  </div>

Â  <div id="dispatch" class="section" style="display:none;">
Â  Â  <h2>ğŸ“œ Dispatch History</h2>
Â  Â  <button class="refresh-btn" onclick="loadDispatchHistory()">ğŸ”„ Refresh</button>
Â  Â  <table id="historyTable">
Â  Â  Â  Â  <thead>
Â  Â  Â  Â  Â  Â  <tr>
Â  Â  Â  Â  Â  Â  Â  Â  <th>Request ID</th>
Â  Â  Â  Â  Â  Â  Â  Â  <th>Patient</th>
Â  Â  Â  Â  Â  Â  Â  Â  <th>Ambulance</th>
Â  Â  Â  Â  Â  Â  Â  Â  <th>Hospital</th>
Â  Â  Â  Â  Â  Â  Â  Â  <th class="why">Outcome</th>
Â  Â  Â  Â  Â  Â  Â  Â  <th>Time</th>
Â  Â  Â  Â  Â  Â  </tr>
Â  Â  Â  Â  </thead>
Â  Â  Â  Â  <tbody></tbody>
Â  Â  </table>
Â  </div>

Â  <div id="reassigned" class="section" style="display:none;">
Â  Â  <h2>â³ Reassigned Emergencies</h2>
Â  Â  <button class="refresh-btn" onclick="loadReassigned()">ğŸ”„ Refresh</button>
Â  Â  <table id="reassignedTable">
Â  Â  Â  Â  <thead>
Â  Â  Â  Â  Â  Â  <tr>
Â  Â  Â  Â  Â  Â  Â  Â  <th>Request ID</th>
Â  Â  Â  Â  Â  Â  Â  Â  <th>Patient</th>
Â  Â  Â  Â  Â  Â  Â  Â  <th>Ambulance</th>
Â  Â  Â  Â  Â  Â  Â  Â  <th>Hospital</th>
Â  Â  Â  Â  Â  Â  Â  Â  <th>Time</th>
Â  Â  Â  Â  Â  Â  </tr>
Â  Â  Â  Â  </thead>
Â  Â  Â  Â  <tbody></tbody>
Â  Â  </table>
Â  </div>

Â  <div id="notifications" class="section" style="display:none;">
    <h2>ğŸ”” Notifications</h2>
    <div id="notification-content">
        <p>Notifications will appear here. The floating button is also available.</p>
    </div>
Â  </div>
    
  Â  <div id="notification-area">
Â    <button onclick="toggleNotifications()">ğŸ”” Notifications (<span id="notif-count">0</span>)</button>
Â    <div id="notif-list" style="display:none;"></div>
Â  </div>

Â  Â  <script>
Â  Â  function showSection(id) {
Â  Â  Â  const sections = ['hospital','ambulance','request','update','dispatch','reassigned','notifications'];
Â  Â  Â  sections.forEach(s => {
Â  Â  Â  Â  document.getElementById(s).style.display = (s === id) ? 'block' : 'none';
Â  Â  Â  });
Â  Â  Â  // Optionally refresh data when a section is shown
Â  Â  Â  if (id === 'hospital') loadHospitals();
Â  Â  Â  if (id === 'ambulance') loadAmbulances();
Â  Â  Â  if (id === 'dispatch') loadDispatchHistory();
Â  Â  Â  if (id === 'reassigned') loadReassigned();
      if (id === 'notifications') fetchNotifications(); // Refresh notifications when section is opened
Â  Â  }

Â  Â  const hospitalResult = document.getElementById('hospitalResult');
Â  Â  const ambulanceResult = document.getElementById('ambulanceResult');
Â  Â  const updateResult = document.getElementById('updateResult');
Â  Â  const emergencyResult = document.getElementById('emergencyResult');

Â  Â  // Hospital Registration
Â  Â  document.getElementById('hospitalForm').addEventListener('submit', e => {
Â  Â  Â  Â  e.preventDefault();
Â  Â  Â  Â  const hospital = {
Â  Â  Â  Â  Â  Â  name: document.getElementById('hospitalName').value,
Â  Â  Â  Â  Â  Â  location: document.getElementById('hospitalLocation').value,
Â  Â  Â  Â  Â  Â  pincode: document.getElementById('hospitalPincode').value,
Â  Â  Â  Â  Â  Â  availableBeds: parseInt(document.getElementById('availableBeds').value)
Â  Â  Â  Â  };
Â  Â  Â  Â  fetch('/api/hospital/add', { method:'POST', headers:{'Content-Type':'application/json'}, body:JSON.stringify(hospital)})
Â  Â  Â  Â  .then(res=>res.json()).then(()=>{ hospitalResult.style.display='block'; hospitalResult.innerHTML='âœ… Hospital registered successfully!'; e.target.reset(); loadHospitals(); });
Â  Â  });

Â  Â  // Ambulance Registration
Â  Â  document.getElementById('ambulanceForm').addEventListener('submit', e => {
Â  Â  Â  Â  e.preventDefault();
Â  Â  Â  Â  const ambulance = {
Â  Â  Â  Â  Â  Â  ambulanceId: document.getElementById('ambulanceId').value,
Â  Â  Â  Â  Â  Â  hospitalId: document.getElementById('ambulanceHospital').value,
Â  Â  Â  Â  Â  Â  location: document.getElementById('ambulanceLocation').value,
Â  Â  Â  Â  Â  Â  pincode: document.getElementById('ambulancePincode').value,
Â  Â  Â  Â  Â  Â  driverName: document.getElementById('driverName').value,
Â  Â  Â  Â  Â  Â  driverPhone: document.getElementById('driverPhone').value,
Â  Â  Â  Â  Â  Â  status:'AVAILABLE'
Â  Â  Â  Â  };
Â  Â  Â  Â  fetch('/api/ambulance/add',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify(ambulance)})
Â  Â  Â  Â  .then(res=>res.json()).then(()=>{ ambulanceResult.style.display='block'; ambulanceResult.innerHTML='âœ… Ambulance registered successfully!'; e.target.reset(); loadAmbulances(); });
Â  Â  });

Â  Â  // Emergency Request
Â  Â  document.getElementById('emergencyForm').addEventListener('submit', e=>{
Â  Â  Â  Â  e.preventDefault();
Â  Â  Â  Â  const pincode=parseInt(document.getElementById('patientPincode').value);
Â  Â  Â  Â  if(isNaN(pincode) || pincode<600001 || pincode>600130){
Â  Â  Â  Â  Â  Â  emergencyResult.style.display='block';
Â  Â  Â  Â  Â  Â  emergencyResult.innerHTML=`<span style="color:#d32f2f;font-size:1.15em;">âŒ Sorry, our service is not available for pincode <b>${pincode}</b>.<br><span style="color:#007bff;">We only serve Chennai (600001-600130).</span></span>`;
Â  Â  Â  Â  Â  Â  return;
Â  Â  Â  Â  }
Â  Â  Â  Â  const request={
Â  Â  Â  Â  Â  Â  patientName: document.getElementById('patientName').value,
Â  Â  Â  Â  Â  Â  contactNo: document.getElementById('contactNo').value,
Â  Â  Â  Â  Â  Â  emergencyType: document.getElementById('emergencyType').value,
Â  Â  Â  Â  Â  Â  patientLocation: document.getElementById('patientLocation').value,
Â  Â  Â  Â  Â  Â  pincode
Â  Â  Â  Â  };
Â  Â  Â  Â  fetch('/api/emergency/new',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify(request)})
Â  Â  Â  Â  .then(res=>res.json()).then(data=>{
Â  Â  Â  Â  Â  Â  emergencyResult.style.display='block';
Â  Â  Â  Â  Â  Â  if(data.status==='ASSIGNED'){
Â  Â  Â  Â  Â  Â  Â  Â  emergencyResult.innerHTML=`<div style="font-size:1.1em;">
Â  Â  Â  Â  Â  Â  Â  Â  <span style="font-size:1.3em;">ğŸš¨ Emergency Request Created!</span><br>
Â  Â  Â  Â  Â  Â  Â  Â  <span>Status: <b style="color:#007bff">${data.status}</b></span><br><br>
Â  Â  Â  Â  Â  Â  Â  Â  <span style="color:#28a745;">âœ… Assignment Details:</span><br>
Â  Â  Â  Â  Â  Â  Â  Â  <b>Patient Pincode:</b> ${data.pincode}<br>
Â  Â  Â  Â  Â  Â  Â  Â  ğŸš <b>Ambulance:</b> ${data.assignedAmbulance.ambulanceId}<br>
Â  Â  Â  Â  Â  Â  Â  Â  ğŸ‘¨â€âœˆ <b>Driver:</b> ${data.assignedAmbulance.driverName} <span style="color:#007bff;">(ğŸ“ ${data.assignedAmbulance.driverPhone})</span><br>
Â  Â  Â  Â  Â  Â  Â  Â  <b>Ambulance Pincode:</b> ${data.assignedAmbulance.pincode}<br>
Â  Â  Â  Â  Â  Â  Â  Â  ğŸš<b>Estimated Arrival:</b> ${data.etaMinutes} minutes<br>
Â  Â  Â  Â  Â  Â  Â  Â  ğŸ¥ <b>Hospital:</b> ${data.assignedHospital.name} <span style="color:#007bff;">(Beds Left: ${data.assignedHospital.availableBeds})</span><br>
Â  Â  Â  Â  Â  Â  Â  Â  <b>Hospital Pincode:</b> ${data.assignedHospital.pincode}<br>
Â  Â  Â  Â  Â  Â  Â  Â  <span style="color:#ff9800;">ğŸ“Œ Why:</span> Nearest ambulance and hospital with available beds.
Â  Â  Â  Â  Â  Â  Â  Â  </div>`;
Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  emergencyResult.innerHTML=`<span style="font-size:1.2em;">ğŸš¨ Emergency Request Created! Status: <b>${data.status}</b></span>`;
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  e.target.reset();
Â  Â  Â  Â  Â  Â  loadAmbulances(); loadHospitals(); loadDispatchHistory();
Â  Â  Â  Â  });
Â  Â  });

Â  Â  // Update Ambulance Status
Â  Â  document.getElementById("updateAmbulanceForm").addEventListener("submit", e=>{
Â  Â  Â  Â  e.preventDefault();
Â  Â  Â  Â  const ambulanceId=document.getElementById("updateAmbulanceId").value;
Â  Â  Â  Â  const status=document.getElementById("ambulanceStatus").value;
Â  Â  Â  Â  fetch(`/api/ambulance/update-status?ambulanceId=${ambulanceId}&status=${status}`,{method:"POST"})
Â  Â  Â  Â  .then(res=>res.text()).then(msg=>{ updateResult.style.display='block'; updateResult.innerText=msg; loadAmbulances(); });
Â  Â  });

Â  Â  // Load Ambulances
Â  Â  function loadAmbulances(){ fetch('/api/ambulance/all').then(res=>res.json()).then(data=>{
Â  Â  Â  Â  const tbody=document.querySelector("#ambulanceTable tbody"); tbody.innerHTML="";
Â  Â  Â  Â  data.forEach(a=>{ tbody.innerHTML+=`<tr>
Â  Â  Â  Â  Â  Â  <td><b>${a.ambulanceId}</b></td>
Â  Â  Â  Â  Â  Â  <td>${a.hospitalId}</td>
Â  Â  Â  Â  Â  Â  <td>${a.location}</td>
Â  Â  Â  Â  Â  Â  <td>${a.pincode}</td>
Â  Â  Â  Â  Â  Â  <td>${a.driverName}</td>
Â  Â  Â  Â  Â  Â  <td><span style="color:${a.status==='AVAILABLE'?'#28a745':'#d32f2f'}">${a.status}</span></td>
Â  Â  Â  Â  </tr>`; });
Â  Â  }); }

Â  Â  // Load Hospitals
Â  Â  function loadHospitals() {
Â  Â  Â  Â  fetch('/api/hospital/all')
Â  Â  Â  Â  Â  Â  .then(res => res.json())
Â  Â  Â  Â  Â  Â  .then(data => {
Â  Â  Â  Â  Â  Â  Â  Â  const tbody = document.querySelector("#hospitalTable tbody");
Â  Â  Â  Â  Â  Â  Â  Â  tbody.innerHTML = "";
Â  Â  Â  Â  Â  Â  Â  Â  data.forEach(h => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  tbody.innerHTML += `
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <tr>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <td>${h.id}</td>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <td><b>${h.name}</b></td>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <td>${h.location}</td>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <td>${h.pincode}</td>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <td>${h.availableBeds}</td>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <td><button onclick="deleteHospital('${h.id}')">ğŸ—‘ï¸ Delete</button></td>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </tr>`;
Â  Â  Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â  });
Â  Â  }

Â  Â  // Delete Hospital by ID
Â  Â  function deleteHospital(id) {
Â  Â  Â  Â  if (confirm("Are you sure you want to delete this hospital?")) {
Â  Â  Â  Â  Â  Â  fetch(`/api/hospital/delete/${id}`, { method: "DELETE" })
Â  Â  Â  Â  Â  Â  Â  Â  .then(res => res.text())
Â  Â  Â  Â  Â  Â  Â  Â  .then(msg => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  alert(msg);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  loadHospitals();
Â  Â  Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  }
Â  Â  }

Â  Â  // Load Dispatch History
Â  Â  function loadDispatchHistory(){ fetch('/api/dispatch/history').then(res=>res.json()).then(data=>{
Â  Â  Â  Â  const tbody=document.querySelector("#historyTable tbody"); tbody.innerHTML="";
Â  Â  Â  Â  data.forEach(d=>{ tbody.innerHTML+=`<tr>
Â  Â  Â  Â  Â  Â  <td>${d.requestId}</td>
Â  Â  Â  Â  Â  Â  <td>${d.patientName} (${d.patientPincode})</td>
Â  Â  Â  Â  Â  Â  <td><b>${d.ambulanceId||'N/A'}</b></td>
Â  Â  Â  Â  Â  Â  <td>${d.hospitalName||'N/A'}</td>
Â  Â  Â  Â  Â  Â  <td class="why">${d.outcome}</td>
Â  Â  Â  Â  Â  Â  <td>${d.dispatchTime ? new Date(d.dispatchTime.replace(' ', 'T')).toLocaleString('en-IN', { dateStyle: 'short', timeStyle: 'short' }) : 'N/A'}</td>
Â  Â  Â  Â  </tr>`; });
Â  Â  }); }

    // Load Reassigned Emergencies
    function loadReassigned() {
        fetch('/dispatch/reassigned')
            .then(res => res.json())
            .then(data => {
                const tbody = document.querySelector("#reassignedTable tbody");
                tbody.innerHTML = "";
                data.forEach(d => {
                    tbody.innerHTML += `<tr>
                        <td>${d.requestId}</td>
                        <td>${d.patientName} (${d.patientPincode})</td>
                        <td><b>${d.ambulanceId || 'N/A'}</b></td>
                        <td>${d.hospitalName || 'N/A'}</td>
                        <td>${d.dispatchTime ? new Date(d.dispatchTime.replace(' ', 'T')).toLocaleString('en-IN', { dateStyle: 'short', timeStyle: 'short' }) : 'N/A'}</td>
                    </tr>`;
                });
            });
    }

    // Notification Logic
    function toggleNotifications() {
Â      const list = document.getElementById('notif-list');
Â      list.style.display = list.style.display === 'none' ? 'block' : 'none';
    }

    async function fetchNotifications() {
Â      try {
Â  Â      const res = await fetch('/api/notifications/unread');
Â  Â      const data = await res.json();

Â  Â      const count = Array.isArray(data) ? data.length : 0;
Â  Â      document.getElementById('notif-count').textContent = count;
        document.getElementById('notification-content').innerHTML = `<h3>Unread Notifications: ${count}</h3>`; // Update the section content

Â  Â      const list = document.getElementById('notif-list');
Â  Â      list.innerHTML = data.map(n => `
Â  Â  Â  Â    <div>
Â  Â  Â  Â  Â    <strong>${n.title}</strong><br>
Â  Â  Â  Â  Â    ${n.message}<br>
Â  Â  Â  Â  Â    <button onclick="markRead('${n.id}')">Mark as read</button>
Â  Â  Â  Â  Â    <hr>
Â  Â  Â  Â    </div>
Â  Â      `).join('');
        
        // Also update the section with the notification list
        document.getElementById('notification-content').innerHTML += data.map(n => `
Â  Â  Â  Â    <div class="result">
Â  Â  Â  Â  Â    <strong>${n.title}</strong> - ${new Date(n.timestamp).toLocaleString('en-IN', { dateStyle: 'short', timeStyle: 'short' })}<br>
Â  Â  Â  Â  Â    ${n.message}<br>
Â  Â  Â  Â  Â    <button onclick="markRead('${n.id}')">Mark as read</button>
Â  Â  Â  Â    </div>
Â  Â      `).join('');
        
Â      } catch (err) {
Â  Â      console.error("Notification fetch failed:", err);
Â  Â      document.getElementById('notif-count').textContent = "!";
Â      }
    }

    async function markRead(id) {
Â      await fetch('/api/notifications/' + id + '/read', { method: 'POST' });
Â      fetchNotifications();
    }

    // Auto-refresh notifications and initial load
    setInterval(fetchNotifications, 7000);
Â  Â  
Â  Â  // Initial Load functions (runs on page load)
Â  Â  window.onload = () => {
Â  Â  Â  loadHospitals();
Â  Â  Â  loadAmbulances();
Â  Â  Â  loadDispatchHistory();
Â  Â  Â  loadReassigned();
Â  Â  Â  fetchNotifications();
Â  Â  };
Â  </script>
</body>
</html>